# –°–∏—Å—Ç–µ–º–∞ FPS Overlay

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ FPS Overlay –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–∞—Å—Ç–æ—Ç—ã –∫–∞–¥—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è Android. –û–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –≤–∏–¥–µ –æ–≤–µ—Ä–ª–µ—è –ø–æ–≤–µ—Ä—Ö UI –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ FPS –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –ó–∞—Ö–≤–∞—Ç —Ç–∞–π–º–∏–Ω–≥–∞ –∫–∞–¥—Ä–æ–≤ —á–µ—Ä–µ–∑ Choreographer API
- **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU, –ø–∞–º—è—Ç–∏, heap –∏ –ø–æ—Ç–æ–∫–æ–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–í–∏–∑—É–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä–ª–µ–π** - –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ FPS —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –∏—Å—Ç–æ—Ä–∏–∏
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∏–∫–æ–≤** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞–¥–µ–Ω–∏–π FPS, –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ jank
- **Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - Room –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- **–£—á—ë—Ç –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç/—Å—Ç–æ–ø –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç lifecycle –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```kotlin
class MainActivity : AppCompatActivity() {
    private lateinit var overlayManager: FpsOverlayManager

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–≤–µ—Ä–ª–µ—è
        overlayManager = FpsOverlayManager.create(this)
        overlayManager.attachToActivity(this)
    }

    override fun onDestroy() {
        super.onDestroy()
        overlayManager.detachFromActivity()
    }
}
```

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```kotlin
val config = FpsOverlayManager.OverlayConfig(
    gravity = Gravity.TOP or Gravity.END,  // –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª
    marginTop = 100,  // –ù–∏–∂–µ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞
    marginRight = 16,
    showToasts = true,  // –í–∫–ª—é—á–∏—Ç—å toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    recordToDatabase = true  // –í–∫–ª—é—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
)

overlayManager = FpsOverlayManager.create(
    context = this,
    logger = AndroidMetricsLogger.forDevelopment(),
    config = config
)
```

### 3. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏

```kotlin
lifecycleScope.launch {
    // –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ FPS –º–µ—Ç—Ä–∏–∫–∞–º–∏
    overlayManager.fpsCollector.fpsFlow.collect { metrics ->
        when {
            metrics.isCritical -> showPerformanceWarning()
            metrics.isSmooth -> hidePerformanceWarning()
        }
    }
}

lifecycleScope.launch {
    // –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø–∏–∫–æ–≤—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
    overlayManager.fpsCollector.peakEventFlow.collect { event ->
        when (event) {
            is FpsPeakEvent.FrameDrop -> logFrameDrop(event)
            is FpsPeakEvent.CriticalJank -> reportJank(event)
            is FpsPeakEvent.HighPerformance -> { /* –æ—Ç–ª–∏—á–Ω–æ! */ }
        }
    }
}
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### FpsMetricsCollector

–°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ FPS –∏—Å–ø–æ–ª—å–∑—É—è Choreographer API Android.

```kotlin
val collector = FpsMetricsCollector()

// –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞
collector.startCollection()

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
val stats = collector.getCurrentStats()
println("–°—Ä–µ–¥–Ω–∏–π FPS: ${stats.averageFps}")
println("–ú–∏–Ω FPS: ${stats.minFps}")
println("Janky –∫–∞–¥—Ä–æ–≤: ${stats.jankFrames}")

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–±–æ—Ä–∞
collector.stopCollection()
```

**–ö–ª—é—á–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:**
- `fpsFlow: StateFlow<FpsMetrics>` - –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ FPS
- `peakEventFlow: SharedFlow<FpsPeakEvent>` - –ü–∏–∫–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- `isActive: Boolean` - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±–æ—Ä–∞

### AppMetricsCollector

–°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

```kotlin
val appCollector = AppMetricsCollector(context)

// –ó–∞–ø—É—Å–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 500–º—Å
appCollector.startCollection(intervalMs = 500)

// –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏
appCollector.metricsFlow.collect { metrics ->
    println("CPU –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ${metrics.cpuUsagePercent}%")
    println("Heap: ${metrics.heapUsageMb} MB / ${metrics.heapMaxMb} MB")
    println("–ü–æ—Ç–æ–∫–æ–≤: ${metrics.threadCount}")
}
```

**–°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU (—Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (PSS)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ heap –∏ –º–∞–∫—Å. heap
- Native heap
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤
- –°–µ—Ç–µ–≤–æ–π I/O (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
- –û—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã

### FpsOverlayView

–ö–∞—Å—Ç–æ–º–Ω—ã–π View –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ FPS –æ–≤–µ—Ä–ª–µ—è.

```kotlin
val overlay = FpsOverlayView(context)

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∞–º–∏
overlay.updateMetrics(overlayMetrics)

// –ò–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
overlay.updateFps(fpsMetrics)
overlay.updateAppMetrics(appMetrics)

// –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
overlay.clearHistory()
```

**–≠–ª–µ–º–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- –¢–µ–∫—É—â–∏–π FPS (—Å —Ü–≤–µ—Ç–æ–≤–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π)
- –°—Ä–µ–¥–Ω–∏–π FPS
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- –ì—Ä–∞—Ñ–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏ FPS (60 –∫–∞–¥—Ä–æ–≤)

**–¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞:**
- üü¢ –ó–µ–ª—ë–Ω—ã–π: FPS ‚â• 55 (–ø–ª–∞–≤–Ω–æ)
- üü° –ñ—ë–ª—Ç—ã–π: FPS 30-54 (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
- üî¥ –ö—Ä–∞—Å–Ω—ã–π: FPS < 30 (–∫—Ä–∏—Ç–∏—á–Ω–æ)

### FpsRepository

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ Room –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

```kotlin
val repository = FpsRepository.getInstance(context)

// –ó–∞–ø–∏—Å—å FPS
repository.recordFps(fpsMetrics)

// –ó–∞–ø–∏—Å—å –ø–∏–∫–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
repository.recordPeakEvent(peakEvent)

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
val stats = repository.getStatisticsForPeriod(days = 1)

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
repository.cleanupOldRecords(daysToKeep = 7)
```

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### FpsMetrics

```kotlin
data class FpsMetrics(
    val timestamp: Long,
    val currentFps: Int,        // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π FPS
    val averageFps: Float,      // –°—Ä–µ–¥–Ω–∏–π –∑–∞ –æ–∫–Ω–æ
    val minFps: Int,            // –ú–∏–Ω–∏–º—É–º –≤ –æ–∫–Ω–µ
    val maxFps: Int,            // –ú–∞–∫—Å–∏–º—É–º –≤ –æ–∫–Ω–µ
    val frameCount: Int,        // –ö–∞–¥—Ä–æ–≤ –≤ –æ–∫–Ω–µ
    val frameTimeMs: Float,     // –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∫–∞–¥—Ä–∞
    val jankCount: Int          // Janky –∫–∞–¥—Ä–æ–≤
) {
    val isSmooth: Boolean       // FPS ‚â• 55
    val isWarning: Boolean      // FPS 30-54
    val isCritical: Boolean     // FPS < 30
    val status: FpsStatus       // SMOOTH, WARNING, CRITICAL
    val jankPercentage: Float   // –ü—Ä–æ—Ü–µ–Ω—Ç jank
}
```

### AppMetrics

```kotlin
data class AppMetrics(
    val timestamp: Long,
    val packageName: String,
    val cpuUsagePercent: Float,     // CPU –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    val memoryUsageMb: Float,       // –û–±—â–∞—è –ø–∞–º—è—Ç—å (PSS)
    val heapUsageMb: Float,         // Java heap
    val heapMaxMb: Float,           // –ú–∞–∫—Å heap
    val nativeHeapMb: Float,        // Native heap
    val threadCount: Int,           // –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
    val networkRxBytes: Long,       // –ü–æ–ª—É—á–µ–Ω–æ –±–∞–π—Ç
    val networkTxBytes: Long,       // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–∞–π—Ç
    val openFileDescriptors: Int    // –û—Ç–∫—Ä—ã—Ç—ã—Ö FD
) {
    val heapUsagePercent: Float     // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ heap %
    val isHeapWarning: Boolean      // Heap ‚â• 80%
    val isHeapCritical: Boolean     // Heap ‚â• 95%
    val totalMemoryMb: Float        // Heap + native
    val memoryStatus: MemoryStatus  // HEALTHY, MODERATE, WARNING, CRITICAL
}
```

### FpsPeakEvent

```kotlin
sealed class FpsPeakEvent {
    data class FrameDrop(
        val timestamp: Long,
        val fps: Int,
        val delta: Int,         // –í–µ–ª–∏—á–∏–Ω–∞ –ø–∞–¥–µ–Ω–∏—è FPS
        val previousFps: Int
    ) : FpsPeakEvent() {
        val severity: Severity  // LOW, MEDIUM, HIGH
    }

    data class HighPerformance(
        val timestamp: Long,
        val fps: Int
    ) : FpsPeakEvent()

    data class CriticalJank(
        val timestamp: Long,
        val fps: Int,
        val duration: Long      // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å jank –≤ –º—Å
    ) : FpsPeakEvent()
}
```

## –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|------|----------|
| –ó–∞–ø–∏—Å—å –∫–∞–¥—Ä–∞ | <1–º—Å | –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∫–∞–¥—Ä |
| –†–∞—Å—á—ë—Ç FPS | <2–º—Å | –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ |
| –ü–∞–º—è—Ç—å | <600–ö–ë | –û–±—â–∏–π footprint –æ–≤–µ—Ä–ª–µ—è |
| –ù–∞–∫–ª–∞–¥–Ω—ã–µ CPU | <2% | –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã —Å–±–æ—Ä–∞ |
| –í—Ä–µ–º—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ | <3–º—Å | –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–≤–µ—Ä–ª–µ—è |
| –¢–æ—á–Ω–æ—Å—Ç—å | >99% | –¢–æ—á–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è FPS |

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –¢–æ–ª—å–∫–æ –¥–ª—è Debug —Å–±–æ—Ä–æ–∫

```kotlin
if (BuildConfig.DEBUG) {
    overlayManager = FpsOverlayManager.create(this)
    overlayManager.attachToActivity(this)
}
```

### 2. –£—Å–ª–æ–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

```kotlin
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∂–µ—Å—Ç–æ–º –≤—Å—Ç—Ä—è—Ö–∏–≤–∞–Ω–∏—è –∏–ª–∏ –∫–Ω–æ–ø–∫–æ–π
overlayManager.toggleVisibility()

// –ò–ª–∏ –ø—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
overlayManager.hide()
overlayManager.show()
```

### 3. –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```kotlin
// –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É
lifecycleScope.launch {
    while (isActive) {
        delay(24.hours)
        repository.cleanupOldRecords(daysToKeep = 7)
    }
}
```

### 4. –≠–∫–æ–Ω–æ–º–∏—è –±–∞—Ç–∞—Ä–µ–∏

–û–≤–µ—Ä–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–±–æ—Ä –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (ON_STOP) –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (ON_START).

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û–≤–µ—Ä–ª–µ–π –Ω–µ –≤–∏–¥–µ–Ω

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –±—ã–ª –ª–∏ –≤—ã–∑–≤–∞–Ω `attachToActivity()`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–º–µ–µ—Ç DecorView
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –±—ã–ª –ª–∏ –≤—ã–∑–≤–∞–Ω `hide()`

### –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU

1. –£–º–µ–Ω—å—à–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞
2. –û—Ç–∫–ª—é—á–∏—Ç–µ –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–≤–µ—Ä–ª–µ—è

### –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

1. –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ `detachFromActivity()` –≤ `onDestroy()`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `WeakReference` –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–º–µ–Ω—è–π—Ç–µ coroutine scopes

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ API

–ü–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API —Å–º. –≤ KDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö:

- `FpsMetricsCollector.kt`
- `AppMetricsCollector.kt`
- `FpsOverlayView.kt`
- `FpsOverlayManager.kt`
- `FpsRepository.kt`

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
com.sysmetrics/
‚îú‚îÄ‚îÄ domain/model/
‚îÇ   ‚îú‚îÄ‚îÄ FpsMetrics.kt          # –ú–æ–¥–µ–ª–∏ FPS –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îî‚îÄ‚îÄ AppMetrics.kt          # –ú–æ–¥–µ–ª–∏ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ data/fps/
‚îÇ   ‚îú‚îÄ‚îÄ FpsMetricsCollector.kt # –°–±–æ—Ä FPS —á–µ—Ä–µ–∑ Choreographer
‚îÇ   ‚îú‚îÄ‚îÄ AppMetricsCollector.kt # –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ FpsRepository.kt       # Persistence —Å–ª–æ–π
‚îÇ   ‚îî‚îÄ‚îÄ database/
‚îÇ       ‚îú‚îÄ‚îÄ FpsDatabase.kt     # Room –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îú‚îÄ‚îÄ FpsEntities.kt     # Entity –∫–ª–∞—Å—Å—ã
‚îÇ       ‚îî‚îÄ‚îÄ FpsDao.kt          # DAO –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îî‚îÄ‚îÄ infrastructure/overlay/
    ‚îú‚îÄ‚îÄ FpsOverlayView.kt      # –ö–∞—Å—Ç–æ–º–Ω—ã–π View –æ–≤–µ—Ä–ª–µ—è
    ‚îî‚îÄ‚îÄ FpsOverlayManager.kt   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ lifecycle
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ UI

```kotlin
class PerformanceMonitor(private val context: Context) {
    private val repository = FpsRepository.getInstance(context)
    
    suspend fun checkPerformance(): PerformanceReport {
        val stats = repository.getStatisticsForPeriod(days = 1)
        
        return PerformanceReport(
            averageFps = stats.averageFps,
            jankRate = stats.jankRate,
            stability = stats.stabilityScore,
            recommendation = when {
                stats.averageFps < 30 -> "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
                stats.jankRate > 5 -> "–ß–∞—Å—Ç—ã–µ –ø–æ–¥—ë—Ä–≥–∏–≤–∞–Ω–∏—è"
                stats.stabilityScore < 70 -> "–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π FPS"
                else -> "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ"
            }
        )
    }
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π

```kotlin
lifecycleScope.launch {
    fpsCollector.peakEventFlow.collect { event ->
        when (event) {
            is FpsPeakEvent.CriticalJank -> {
                analytics.logEvent("critical_jank", bundleOf(
                    "fps" to event.fps,
                    "duration" to event.duration,
                    "screen" to currentScreen
                ))
            }
            is FpsPeakEvent.FrameDrop -> {
                if (event.severity == FpsPeakEvent.Severity.HIGH) {
                    analytics.logEvent("severe_frame_drop", bundleOf(
                        "fps" to event.fps,
                        "delta" to event.delta
                    ))
                }
            }
            else -> { /* –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å */ }
        }
    }
}
```
